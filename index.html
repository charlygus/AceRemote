<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AceRemote</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <header>
        <div class="header-content">
            <h1>Descubrir</h1>
            <button onclick="iniciarCarga()" class="refresh-btn"><i class="fa-solid fa-arrows-rotate"></i></button>
        </div>
    </header>

    <div id="tabs-container" class="tabs">
        </div>

    <div id="loader" class="loader-container">
        <div id="loader-text" class="loader-text">0%</div>
    </div>
    
    <main id="contenedor-eventos">
        </main>

    <script>
        // ==========================================
        // PEGA TU URL DE GOOGLE APPS SCRIPT AQUÍ
        // ==========================================
        const API_URL = 'PEGA_TU_URL_DE_GOOGLE_AQUI'; 

        let todosLosDatos = []; 

        async function iniciarCarga() {
            const container = document.getElementById('contenedor-eventos');
            const tabsContainer = document.getElementById('tabs-container');
            const loader = document.getElementById('loader');
            const loaderText = document.getElementById('loader-text');
            
            container.innerHTML = ''; 
            tabsContainer.innerHTML = '';
            loader.style.display = 'block';
            
            // Animación de números
            let porcentaje = 0;
            let intervalo = setInterval(() => {
                if (porcentaje < 98) {
                    porcentaje += Math.floor(Math.random() * 8) + 1;
                    if (porcentaje > 99) porcentaje = 99;
                    loaderText.innerText = porcentaje + '%';
                }
            }, 400);

            try {
                const response = await fetch(API_URL);
                const datos = await response.json();
                
                clearInterval(intervalo);
                loaderText.innerText = '100%';
                
                setTimeout(() => {
                    loader.style.display = 'none';
                    todosLosDatos = datos;
                    generarPestanas(datos);
                    renderizar(datos);
                }, 300);

            } catch (error) {
                clearInterval(intervalo);
                loaderText.innerText = 'Error';
                loaderText.style.color = 'red';
            }
        }

        function generarPestanas(datos) {
            const tabsContainer = document.getElementById('tabs-container');
            const categoriasUnicas = [...new Set(datos.map(item => item.categoria))].sort();

            // Botón "Todo"
            const btnTodas = document.createElement('button');
            btnTodas.className = 'tab-btn active';
            btnTodas.innerText = 'Todo';
            btnTodas.onclick = function() { filtrar('TODAS', this); };
            tabsContainer.appendChild(btnTodas);

            categoriasUnicas.forEach(cat => {
                if(cat && cat !== 'undefined') {
                    const btn = document.createElement('button');
                    btn.className = 'tab-btn';
                    btn.innerText = cat; // Ya no mostramos el número para ser más limpios
                    btn.onclick = function() { filtrar(cat, this); };
                    tabsContainer.appendChild(btn);
                }
            });
        }

        function renderizar(lista) {
            const container = document.getElementById('contenedor-eventos');
            container.innerHTML = '';

            if (lista.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#555; margin-top:40px;">Nada por aquí.</p>';
                return;
            }

            lista.forEach(item => {
                // Seleccionar icono basado en el título o categoría
                let icono = 'fa-tv';
                if (item.titulo.includes('FÚTBOL') || item.categoria.includes('FÚTBOL')) icono = 'fa-futbol';
                if (item.categoria.includes('MOTOR')) icono = 'fa-car';
                if (item.categoria.includes('NBA')) icono = 'fa-basketball';

                const row = document.createElement('div');
                row.className = 'track-row';
                // Al hacer click en CUALQUIER PARTE de la fila, se copia
                row.onclick = function() { copiarID(item.id, this); };
                
                row.innerHTML = `
                    <div class="track-icon-box">
                        <i class="fa-solid ${icono}"></i>
                    </div>
                    <div class="track-info">
                        <div class="track-title">${item.titulo}</div>
                        <div class="track-meta">${item.origen} • Toca para copiar</div>
                    </div>
                    <div class="action-icon">
                        <i class="fa-regular fa-copy" style="color:#555;"></i>
                    </div>
                `;
                container.appendChild(row);
            });
        }

        function filtrar(categoria, btn) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Scroll suave del botón al centro si es necesario
            btn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });

            if (categoria === 'TODAS') {
                renderizar(todosLosDatos);
            } else {
                renderizar(todosLosDatos.filter(item => item.categoria === categoria));
            }
        }

        function copiarID(texto, elementoFila) {
            // 1. Vibración (Haptic Feedback) si el móvil lo soporta
            if (navigator.vibrate) navigator.vibrate(50);

            // 2. Copiar al portapapeles
            navigator.clipboard.writeText(texto).then(() => {
                
                // 3. Transformación Visual (La magia)
                // Quitamos la clase 'copied' de cualquier otro que estuviera activo
                document.querySelectorAll('.track-row').forEach(r => r.classList.remove('copied'));
                
                // Activamos ESTA fila
                elementoFila.classList.add('copied');
                
                // Cambiamos el texto y el icono temporalmente
                const titulo = elementoFila.querySelector('.track-title');
                const meta = elementoFila.querySelector('.track-meta');
                const iconBox = elementoFila.querySelector('.track-icon-box');
                const iconAction = elementoFila.querySelector('.action-icon');

                const textoOriginal = titulo.innerText;
                
                // Feedback inmediato
                meta.innerText = "¡ID COPIADO LISTO PARA PEGAR!";
                iconBox.innerHTML = '<i class="fa-solid fa-check"></i>';
                iconAction.innerHTML = '<i class="fa-solid fa-check" style="color:#1DB954;"></i>';

                // (Opcional) Volver al estado normal tras 5 segundos
                // Pero a veces es útil dejarlo verde para saber cual probaste el último.
                
            }).catch(err => {
                alert('Error copiando. Permisos denegados.');
            });
        }

        iniciarCarga();
    </script>
</body>
</html>
