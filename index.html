<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AceRemote</title>
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>

    <header>
        <div class="header-content">
            <div class="brand-container">
                <img src="icon.png" alt="Logo" class="app-logo">
                <h1>AceRemote</h1>
            </div>
            <button onclick="iniciarCarga()" class="refresh-btn">
                <i class="fa-solid fa-arrows-rotate"></i>
            </button>
        </div>
        <div class="search-container">
            <div class="search-wrapper">
                <i class="fa-solid fa-magnifying-glass search-icon"></i>
                <input type="text" id="searchInput" placeholder="Buscar canal o partido..." onkeyup="filtrarBusqueda()">
            </div>
        </div>
    </header>

    <div id="tabs-container" class="tabs"></div>

    <div id="loader" class="loader-container">
        <div id="loader-text" class="loader-text">0%</div>
    </div>
    
    <main id="contenedor-eventos"></main>

    <script>
        // PEGA TU URL DE GOOGLE APPS SCRIPT AQUÍ
        const API_URL = 'https://script.google.com/macros/s/AKfycbyaDrtYeHao6x9R8EWLh6gKAcStTmQuy5xaI3sfGmoYvrR4wSEpggrGEaa7kApO3LjI/exec'; 

        let todosLosDatos = []; 
        let categoriaActual = 'TODAS';

        async function iniciarCarga() {
            const container = document.getElementById('contenedor-eventos');
            const tabsContainer = document.getElementById('tabs-container');
            const loader = document.getElementById('loader');
            const loaderText = document.getElementById('loader-text');
            
            container.innerHTML = ''; 
            tabsContainer.innerHTML = '';
            loader.style.display = 'block';
            
            let porcentaje = 0;
            let intervalo = setInterval(() => {
                if (porcentaje < 98) {
                    porcentaje += Math.floor(Math.random() * 8) + 1;
                    loaderText.innerText = porcentaje + '%';
                }
            }, 400);

            try {
                const response = await fetch(API_URL);
                const datos = await response.json();
                clearInterval(intervalo);
                loaderText.innerText = '100%';
                setTimeout(() => {
                    loader.style.display = 'none';
                    todosLosDatos = datos;
                    generarPestanas(datos);
                    renderizar(datos);
                }, 300);
            } catch (error) {
                clearInterval(intervalo);
                loaderText.innerText = 'Error';
            }
        }

        function generarPestanas(datos) {
            const tabsContainer = document.getElementById('tabs-container');
            let categorias = [...new Set(datos.map(item => item.categoria))].sort();

            const btnTodas = document.createElement('button');
            btnTodas.className = 'tab-btn active';
            btnTodas.innerText = 'Todo';
            btnTodas.onclick = function() { filtrar('TODAS', this); };
            tabsContainer.appendChild(btnTodas);

            // PRIORIDAD PIMPLE TV
            const indexPimple = categorias.indexOf("PIMPLE TV");
            if (indexPimple !== -1) {
                categorias.splice(indexPimple, 1);
                categorias.unshift("PIMPLE TV");
            }

            categorias.forEach(cat => {
                if(cat) {
                    const btn = document.createElement('button');
                    btn.className = 'tab-btn';
                    btn.innerText = cat; 
                    btn.onclick = function() { filtrar(cat, this); };
                    tabsContainer.appendChild(btn);
                }
            });
        }

        function renderizar(lista, esBusqueda = false) {
            const container = document.getElementById('contenedor-eventos');
            container.innerHTML = '';
            if (lista.length === 0) {
                container.innerHTML = `<p style="text-align:center; color:#555; margin-top:40px;">No hay canales activos ahora.</p>`;
                return;
            }
            lista.forEach(item => {
                let icono = 'fa-tv';
                const txt = (item.titulo + item.categoria).toUpperCase();
                if (txt.includes('FÚTBOL') || txt.includes('SOCCER')) icono = 'fa-futbol';
                else if (txt.includes('MOTOR') || txt.includes('F1')) icono = 'fa-car';
                else if (txt.includes('NBA')) icono = 'fa-basketball';

                const row = document.createElement('div');
                row.className = 'track-row';
                row.onclick = function() { copiarID(item.id, this); };
                row.innerHTML = `
                    <div class="track-icon-box"><i class="fa-solid ${icono}"></i></div>
                    <div class="track-info">
                        <div class="track-title">${item.titulo}</div>
                        <div class="track-meta">${item.origen} • Toca para copiar</div>
                    </div>
                    <div class="action-icon"><i class="fa-regular fa-copy"></i></div>
                `;
                container.appendChild(row);
            });
        }

        function filtrar(categoria, btn) {
            categoriaActual = categoria;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            btn.scrollIntoView({ behavior: 'smooth', inline: 'center' });
            renderizar(categoria === 'TODAS' ? todosLosDatos : todosLosDatos.filter(i => i.categoria === categoria));
        }

        function filtrarBusqueda() {
            const texto = document.getElementById('searchInput').value.toLowerCase();
            if (texto.length > 0) {
                renderizar(todosLosDatos.filter(i => (i.titulo + i.categoria).toLowerCase().includes(texto)), true);
            } else {
                renderizar(categoriaActual === 'TODAS' ? todosLosDatos : todosLosDatos.filter(i => i.categoria === categoriaActual));
            }
        }

        function copiarID(texto, elementoFila) {
            if (navigator.vibrate) navigator.vibrate(50);
            navigator.clipboard.writeText(texto).then(() => {
                document.querySelectorAll('.track-row').forEach(r => r.classList.remove('copied'));
                elementoFila.classList.add('copied');
                elementoFila.querySelector('.track-meta').innerText = "¡COPIADO!";
            });
        }

        iniciarCarga();
    </script>
</body>
</html>
